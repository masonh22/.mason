#!/usr/bin/env bash

MASON_HOME=$(dirname $0) # may be relative
MASON_HOME=$(readlink -f $MASON_HOME) # now it is absolute

cd $MASON_HOME

. install-utils $MASON_HOME $@

echo ''

setup_gitconfig() {
    if ! $no_prompt && [ ! -f ~/.gitconfig.local ]; then
        user 'setup .gitconfig? y/N'
        read -e do_gitconfig
        case "$do_gitconfig" in
            y*|Y*)
                # continue
                ;;
            *)
                return
                ;;
        esac

        user ' - Enter git author name'
        read -e git_name
        user ' - Enter git author email'
        read -e git_email

        sed -e "s/TEMPLATE_NAME/$git_name/" -e "s/TEMPLATE_EMAIL/$git_email/" gitconfig.local.base > ~/.gitconfig.local || exit

        success 'gitconfig'
    fi
}

setup_emacs_early_init() {
    EMACS_HOME="$(get_emacs_home)"
    ret=$?
    if [ $ret != 0 ]; then
        return $ret
    fi

    src=${MASON_HOME}/emacs/early-init.el
    dst=${EMACS_HOME}/early-init.el

    install_action 'ln -s' "$src" "$dst"
}

setup_gitconfig

install_copies
install_symlinks

add_to_emacs setup-mason
setup_emacs_early_init

add_to_rc .bashrc 'MASON_HOME'
add_to_rc .zshrc 'MASON_HOME'

add_to_config alacritty
add_to_config fontconfig
add_to_config ghostty
add_to_config git
add_to_config htop
add_to_config hypr
add_to_config i3
add_to_config niri
add_to_config waybar
